<!DOCTYPE html>
<html>

<head>
  <title>Passboard Maker</title>
  <link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" type="text/css" href="dodopassboard.css">
  <link rel="preload" href="/dodo_passboard/TTNorms-Bold.woff" as="font" type="font/woff" crossorigin>
  <link rel="icon" href="/dodo_passboard/favicon.png">
  <meta name="viewport" content="width=device-width">
</head>

<body>

  <form id="form">
    <img src="welcome.png" id="welcome_image" />
    <br>
    <br>
    <div class="mdc-layout-grid">
      <div class="mdc-layout-grid__inner">
        <div class="mdc-layout-grid__cell">
          <div class="mdc-text-field">
            <input type="text" id="name" placeholder="Placeholder text" class="mdc-text-field__input" required>
            <label class="mdc-floating-label" for="name">Name</label>
            <div class="mdc-line-ripple"></div>
          </div>
        </div>
        <div class="mdc-layout-grid__cell">
          <div class="mdc-text-field">
            <input type="text" id="surname" class="mdc-text-field__input" required>
            <label class="mdc-floating-label" for="surname">Surame</label>
            <div class="mdc-line-ripple"></div>
          </div>
        </div>
        <div class="mdc-layout-grid__cell">
          <div class="mdc-text-field">
            <input type="datetime-local" id="departure" class="mdc-text-field__input" required>
            <label class="mdc-floating-label" for="surname">Departure</label>
            <div class="mdc-line-ripple"></div>
          </div>
        </div>
      </div>
      <br>
      <br>
      <div class="mdc-layout-grid__inner">
        <div class="mdc-layout-grid__cell--span-12">
          <button type="submit" class="mdc-button mdc-button--raised foo-button" id="generate_passboard"
            onclick="render();return false">
            <div class="mdc-button__ripple"></div>
            <span class="mdc-button__label">GENERATE PASSBOARD</span>
            <i class="material-icons mdc-button__icon" aria-hidden="true">local_offer</i>
          </button>
        </div>
      </div>
      <div class="mdc-layout-grid__inner">
        <div class="mdc-layout-grid__cell--span-12">
          <canvas id="canvas" width="1000" height="500">
            Your browser does not support the HTML5 canvas tag.</canvas>
      
        </div>
      </div>
    </div>

    <!-- <div class="mdc-text-field">
      <input type="text" id="name" placeholder="Placeholder text" class="mdc-text-field__input" required>
      <label class="mdc-floating-label" for="name">Name</label>
      <div class="mdc-line-ripple"></div>
    </div>


    <div class="mdc-text-field">
      <input type="text" id="surname" class="mdc-text-field__input" required>
      <label class="mdc-floating-label" for="surname">Surame</label>
      <div class="mdc-line-ripple"></div>
    </div>
    <br>
    <br>
    <div class="mdc-text-field">
      <input type="datetime-local" id="departure" class="mdc-text-field__input" required>
      <label class="mdc-floating-label" for="surname">Departure</label>
      <div class="mdc-line-ripple"></div>
    </div>

    <br>
    <br>

    <button type="submit" class="mdc-button mdc-button--raised foo-button" id="generate_passboard"
      onclick="render();return false">
      <div class="mdc-button__ripple"></div>
      <span class="mdc-button__label">GENERATE PASSBOARD</span>
      <i class="material-icons mdc-button__icon" aria-hidden="true">local_offer</i>
    </button> -->

    <br>
    <br>
<!--     <canvas id="canvas" width="1000" height="500">
      Your browser does not support the HTML5 canvas tag.</canvas> -->

    <img src="ACNH-BoardingPass-BLANK.svg" width="6000" height="3000" id="background" style="display: none;" />
    <br>
    <br>

  </form>

  <script>
    //We initialize all the input fields animations
    const edtTexts = [].map.call(document.querySelectorAll('.mdc-text-field'), function (el) {
      return new mdc.textField.MDCTextField(el);
    });

    //We initialize the button animation
    mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));

    //We create and prepare the canvas
    var c = document.getElementById("canvas");
    var ctx = c.getContext("2d");
    c.width = 2000;
    c.height = 880;
    c.style.width = "1000px";
    c.style.height = "440px";

    //We obtain the background image
    const background = document.getElementById('background');

    function render() {


      //We combine the name and the surname into one
      const name = document.getElementById("name").value;
      const surname = document.getElementById("surname").value;
      const complete_name = name + ' ' + surname;

      //We divide and enrich the departure information
      const departure = document.getElementById("departure").value;
      const departure_date_type = new Date(departure.substring(0, 4), departure.substring(5, 7), departure.substring(8,
        10));
      const short_month = departure_date_type.toLocaleString('en-us', {
        month: 'short'
      });
      const departure_day_ordinal = getOrdinalSuper(departure.substring(8, 10));
      const departure_date = short_month + '. ' + departure.substring(8, 10) + departure_day_ordinal + ', ' + departure
        .substring(0, 4);
      const departure_time = departure.substring(11, 16);

      console.log(window.location.pathname);

      if (!name) {
        console.log("Empty name");
        return false;
      } else if (!surname) {
        console.log("Empty surname");
        return false;
      } else if (!departure) {
        console.log("Empty destination");
        return false;
      }

      //We generate random seat and gate
      const seat_number = Math.round(Math.random() * 10);
      const seat_letter = String.fromCharCode(65 + Math.floor(Math.random() * 6));
      const gate_number = Math.round(Math.random() * 100);
      const gate_letter = String.fromCharCode(65 + Math.floor(Math.random() * 6));
      const seat_gate = seat_number + seat_letter + '/' + gate_number + gate_letter;

      //We draw the background image
      ctx.drawImage(background, 8, 0);

      //We fill the left part of the ticket
      ctx.font = "55px TTNorms";
      ctx.fillStyle = "#7d705d";
      ctx.fillText(complete_name, 180, 540);
      ctx.fillText(seat_gate, 750, 540);
      ctx.fillText(departure_date, 180, 760);
      ctx.fillText(departure_time, 750, 760);

      //We fill the right part of the ticket
      ctx.font = "50px TTNorms";
      ctx.fillStyle = "#00af89";
      ctx.fillText(complete_name, 1420, 370);
      ctx.fillText(departure_date, 1420, 520);
      ctx.fillText(seat_gate, 1420, 670);
      ctx.fillText(departure_time, 1420, 820);

      return false;

    }

    //Functions that returns the ordinal for a given date
    function getOrdinalSuper(n) {
      return (n > 0 ? ['\u1D57\u02B0', '\u02E2\u1D57', '\u207F\u1D48', '\u02B3\u1D48'][(n > 3 && n < 21) || n % 10 > 3 ?
        0 : n % 10
      ] : '');
    }
  </script>

</body>

</html>